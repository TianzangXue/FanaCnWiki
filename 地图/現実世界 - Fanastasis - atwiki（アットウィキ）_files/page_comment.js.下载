(()=>{var t={5089:(t,e,n)=>{var r=n(930),a=n(9268),i=TypeError;t.exports=function(t){if(r(t))return t;throw i(a(t)+" is not a function")}},4226:(t,e,n)=>{var r=n(4004).has;t.exports=function(t){return r(t),t}},6112:(t,e,n)=>{var r=n(8759),a=String,i=TypeError;t.exports=function(t){if(r(t))return t;throw i(a(t)+" is not an object")}},6198:(t,e,n)=>{var r=n(4088),a=n(7740),i=n(2871),o=function(t){return function(e,n,o){var s,c=r(e),u=i(c),l=a(o,u);if(t&&n!=n){for(;u>l;)if((s=c[l++])!=s)return!0}else for(;u>l;l++)if((t||l in c)&&c[l]===n)return t||l||0;return!t&&-1}};t.exports={includes:o(!0),indexOf:o(!1)}},2306:(t,e,n)=>{var r=n(8240),a=r({}.toString),i=r("".slice);t.exports=function(t){return i(a(t),8,-1)}},8474:(t,e,n)=>{var r=n(9606),a=n(6095),i=n(4399),o=n(7826);t.exports=function(t,e,n){for(var s=a(e),c=o.f,u=i.f,l=0;l<s.length;l++){var p=s[l];r(t,p)||n&&r(n,p)||c(t,p,u(e,p))}}},2585:(t,e,n)=>{var r=n(5283),a=n(7826),i=n(5736);t.exports=r?function(t,e,n){return a.f(t,e,i(1,n))}:function(t,e,n){return t[e]=n,t}},5736:t=>{t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},1343:(t,e,n)=>{var r=n(930),a=n(7826),i=n(3712),o=n(9444);t.exports=function(t,e,n,s){s||(s={});var c=s.enumerable,u=void 0!==s.name?s.name:e;if(r(n)&&i(n,u,s),s.global)c?t[e]=n:o(e,n);else{try{s.unsafe?t[e]&&(c=!0):delete t[e]}catch(t){}c?t[e]=n:a.f(t,e,{value:n,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return t}},9444:(t,e,n)=>{var r=n(2086),a=Object.defineProperty;t.exports=function(t,e){try{a(r,t,{value:e,configurable:!0,writable:!0})}catch(n){r[t]=e}return e}},5283:(t,e,n)=>{var r=n(3677);t.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},7886:t=>{var e="object"==typeof document&&document.all,n=void 0===e&&void 0!==e;t.exports={all:e,IS_HTMLDDA:n}},821:(t,e,n)=>{var r=n(2086),a=n(8759),i=r.document,o=a(i)&&a(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},4999:t=>{t.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},1448:(t,e,n)=>{var r,a,i=n(2086),o=n(4999),s=i.process,c=i.Deno,u=s&&s.versions||c&&c.version,l=u&&u.v8;l&&(a=(r=l.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!a&&o&&(!(r=o.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=o.match(/Chrome\/(\d+)/))&&(a=+r[1]),t.exports=a},8684:t=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},1695:(t,e,n)=>{var r=n(2086),a=n(4399).f,i=n(2585),o=n(1343),s=n(9444),c=n(8474),u=n(7189);t.exports=function(t,e){var n,l,p,d,m,f=t.target,h=t.global,g=t.stat;if(n=h?r:g?r[f]||s(f,{}):(r[f]||{}).prototype)for(l in e){if(d=e[l],p=t.dontCallGetSet?(m=a(n,l))&&m.value:n[l],!u(h?l:f+(g?".":"#")+l,t.forced)&&void 0!==p){if(typeof d==typeof p)continue;c(d,p)}(t.sham||p&&p.sham)&&i(d,"sham",!0),o(n,l,d,t)}}},3677:t=>{t.exports=function(t){try{return!!t()}catch(t){return!0}}},6059:(t,e,n)=>{var r=n(3677);t.exports=!r((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},9413:(t,e,n)=>{var r=n(6059),a=Function.prototype.call;t.exports=r?a.bind(a):function(){return a.apply(a,arguments)}},4398:(t,e,n)=>{var r=n(5283),a=n(9606),i=Function.prototype,o=r&&Object.getOwnPropertyDescriptor,s=a(i,"name"),c=s&&"something"===function(){}.name,u=s&&(!r||r&&o(i,"name").configurable);t.exports={EXISTS:s,PROPER:c,CONFIGURABLE:u}},8240:(t,e,n)=>{var r=n(6059),a=Function.prototype,i=a.call,o=r&&a.bind.bind(i,i);t.exports=r?o:function(t){return function(){return i.apply(t,arguments)}}},563:(t,e,n)=>{var r=n(2086),a=n(930);t.exports=function(t,e){return arguments.length<2?(n=r[t],a(n)?n:void 0):r[t]&&r[t][e];var n}},2964:(t,e,n)=>{var r=n(5089),a=n(1858);t.exports=function(t,e){var n=t[e];return a(n)?void 0:r(n)}},2086:(t,e,n)=>{var r=function(t){return t&&t.Math==Math&&t};t.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof n.g&&n.g)||function(){return this}()||Function("return this")()},9606:(t,e,n)=>{var r=n(8240),a=n(3060),i=r({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,e){return i(a(t),e)}},7153:t=>{t.exports={}},6761:(t,e,n)=>{var r=n(5283),a=n(3677),i=n(821);t.exports=!r&&!a((function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},5974:(t,e,n)=>{var r=n(8240),a=n(3677),i=n(2306),o=Object,s=r("".split);t.exports=a((function(){return!o("z").propertyIsEnumerable(0)}))?function(t){return"String"==i(t)?s(t,""):o(t)}:o},9277:(t,e,n)=>{var r=n(8240),a=n(930),i=n(4489),o=r(Function.toString);a(i.inspectSource)||(i.inspectSource=function(t){return o(t)}),t.exports=i.inspectSource},3278:(t,e,n)=>{var r,a,i,o=n(640),s=n(2086),c=n(8759),u=n(2585),l=n(9606),p=n(4489),d=n(8944),m=n(7153),f="Object already initialized",h=s.TypeError,g=s.WeakMap;if(o||p.state){var v=p.state||(p.state=new g);v.get=v.get,v.has=v.has,v.set=v.set,r=function(t,e){if(v.has(t))throw h(f);return e.facade=t,v.set(t,e),e},a=function(t){return v.get(t)||{}},i=function(t){return v.has(t)}}else{var w=d("state");m[w]=!0,r=function(t,e){if(l(t,w))throw h(f);return e.facade=t,u(t,w,e),e},a=function(t){return l(t,w)?t[w]:{}},i=function(t){return l(t,w)}}t.exports={set:r,get:a,has:i,enforce:function(t){return i(t)?a(t):r(t,{})},getterFor:function(t){return function(e){var n;if(!c(e)||(n=a(e)).type!==t)throw h("Incompatible receiver, "+t+" required");return n}}}},930:(t,e,n)=>{var r=n(7886),a=r.all;t.exports=r.IS_HTMLDDA?function(t){return"function"==typeof t||t===a}:function(t){return"function"==typeof t}},7189:(t,e,n)=>{var r=n(3677),a=n(930),i=/#|\.prototype\./,o=function(t,e){var n=c[s(t)];return n==l||n!=u&&(a(e)?r(e):!!e)},s=o.normalize=function(t){return String(t).replace(i,".").toLowerCase()},c=o.data={},u=o.NATIVE="N",l=o.POLYFILL="P";t.exports=o},1858:t=>{t.exports=function(t){return null==t}},8759:(t,e,n)=>{var r=n(930),a=n(7886),i=a.all;t.exports=a.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:r(t)||t===i}:function(t){return"object"==typeof t?null!==t:r(t)}},3296:t=>{t.exports=!1},2071:(t,e,n)=>{var r=n(563),a=n(930),i=n(5516),o=n(1876),s=Object;t.exports=o?function(t){return"symbol"==typeof t}:function(t){var e=r("Symbol");return a(e)&&i(e.prototype,s(t))}},2871:(t,e,n)=>{var r=n(4005);t.exports=function(t){return r(t.length)}},3712:(t,e,n)=>{var r=n(8240),a=n(3677),i=n(930),o=n(9606),s=n(5283),c=n(4398).CONFIGURABLE,u=n(9277),l=n(3278),p=l.enforce,d=l.get,m=String,f=Object.defineProperty,h=r("".slice),g=r("".replace),v=r([].join),w=s&&!a((function(){return 8!==f((function(){}),"length",{value:8}).length})),b=String(String).split("String"),y=t.exports=function(t,e,n){"Symbol("===h(m(e),0,7)&&(e="["+g(m(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!o(t,"name")||c&&t.name!==e)&&(s?f(t,"name",{value:e,configurable:!0}):t.name=e),w&&n&&o(n,"arity")&&t.length!==n.arity&&f(t,"length",{value:n.arity});try{n&&o(n,"constructor")&&n.constructor?s&&f(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var r=p(t);return o(r,"source")||(r.source=v(b,"string"==typeof e?e:"")),t};Function.prototype.toString=y((function(){return i(this)&&d(this).source||u(this)}),"toString")},5681:t=>{var e=Math.ceil,n=Math.floor;t.exports=Math.trunc||function(t){var r=+t;return(r>0?n:e)(r)}},7826:(t,e,n)=>{var r=n(5283),a=n(6761),i=n(8202),o=n(6112),s=n(2258),c=TypeError,u=Object.defineProperty,l=Object.getOwnPropertyDescriptor,p="enumerable",d="configurable",m="writable";e.f=r?i?function(t,e,n){if(o(t),e=s(e),o(n),"function"==typeof t&&"prototype"===e&&"value"in n&&m in n&&!n[m]){var r=l(t,e);r&&r[m]&&(t[e]=n.value,n={configurable:d in n?n[d]:r[d],enumerable:p in n?n[p]:r[p],writable:!1})}return u(t,e,n)}:u:function(t,e,n){if(o(t),e=s(e),o(n),a)try{return u(t,e,n)}catch(t){}if("get"in n||"set"in n)throw c("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},4399:(t,e,n)=>{var r=n(5283),a=n(9413),i=n(7446),o=n(5736),s=n(4088),c=n(2258),u=n(9606),l=n(6761),p=Object.getOwnPropertyDescriptor;e.f=r?p:function(t,e){if(t=s(t),e=c(e),l)try{return p(t,e)}catch(t){}if(u(t,e))return o(!a(i.f,t,e),t[e])}},62:(t,e,n)=>{var r=n(1352),a=n(8684).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return r(t,a)}},6952:(t,e)=>{e.f=Object.getOwnPropertySymbols},5516:(t,e,n)=>{var r=n(8240);t.exports=r({}.isPrototypeOf)},1352:(t,e,n)=>{var r=n(8240),a=n(9606),i=n(4088),o=n(6198).indexOf,s=n(7153),c=r([].push);t.exports=function(t,e){var n,r=i(t),u=0,l=[];for(n in r)!a(s,n)&&a(r,n)&&c(l,n);for(;e.length>u;)a(r,n=e[u++])&&(~o(l,n)||c(l,n));return l}},7446:(t,e)=>{"use strict";var n={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,a=r&&!n.call({1:2},1);e.f=a?function(t){var e=r(this,t);return!!e&&e.enumerable}:n},7999:(t,e,n)=>{var r=n(9413),a=n(930),i=n(8759),o=TypeError;t.exports=function(t,e){var n,s;if("string"===e&&a(n=t.toString)&&!i(s=r(n,t)))return s;if(a(n=t.valueOf)&&!i(s=r(n,t)))return s;if("string"!==e&&a(n=t.toString)&&!i(s=r(n,t)))return s;throw o("Can't convert object to primitive value")}},6095:(t,e,n)=>{var r=n(563),a=n(8240),i=n(62),o=n(6952),s=n(6112),c=a([].concat);t.exports=r("Reflect","ownKeys")||function(t){var e=i.f(s(t)),n=o.f;return n?c(e,n(t)):e}},9586:(t,e,n)=>{var r=n(1858),a=TypeError;t.exports=function(t){if(r(t))throw a("Can't call method on "+t);return t}},8944:(t,e,n)=>{var r=n(9197),a=n(5422),i=r("keys");t.exports=function(t){return i[t]||(i[t]=a(t))}},4489:(t,e,n)=>{var r=n(2086),a=n(9444),i="__core-js_shared__",o=r[i]||a(i,{});t.exports=o},9197:(t,e,n)=>{var r=n(3296),a=n(4489);(t.exports=function(t,e){return a[t]||(a[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.29.0",mode:r?"pure":"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.29.0/LICENSE",source:"https://github.com/zloirock/core-js"})},5558:(t,e,n)=>{var r=n(1448),a=n(3677);t.exports=!!Object.getOwnPropertySymbols&&!a((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},7740:(t,e,n)=>{var r=n(9502),a=Math.max,i=Math.min;t.exports=function(t,e){var n=r(t);return n<0?a(n+e,0):i(n,e)}},4088:(t,e,n)=>{var r=n(5974),a=n(9586);t.exports=function(t){return r(a(t))}},9502:(t,e,n)=>{var r=n(5681);t.exports=function(t){var e=+t;return e!=e||0===e?0:r(e)}},4005:(t,e,n)=>{var r=n(9502),a=Math.min;t.exports=function(t){return t>0?a(r(t),9007199254740991):0}},3060:(t,e,n)=>{var r=n(9586),a=Object;t.exports=function(t){return a(r(t))}},1288:(t,e,n)=>{var r=n(9413),a=n(8759),i=n(2071),o=n(2964),s=n(7999),c=n(211),u=TypeError,l=c("toPrimitive");t.exports=function(t,e){if(!a(t)||i(t))return t;var n,c=o(t,l);if(c){if(void 0===e&&(e="default"),n=r(c,t,e),!a(n)||i(n))return n;throw u("Can't convert object to primitive value")}return void 0===e&&(e="number"),s(t,e)}},2258:(t,e,n)=>{var r=n(1288),a=n(2071);t.exports=function(t){var e=r(t,"string");return a(e)?e:e+""}},9268:t=>{var e=String;t.exports=function(t){try{return e(t)}catch(t){return"Object"}}},5422:(t,e,n)=>{var r=n(8240),a=0,i=Math.random(),o=r(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+o(++a+i,36)}},1876:(t,e,n)=>{var r=n(5558);t.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},8202:(t,e,n)=>{var r=n(5283),a=n(3677);t.exports=r&&a((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},640:(t,e,n)=>{var r=n(2086),a=n(930),i=r.WeakMap;t.exports=a(i)&&/native code/.test(String(i))},4004:(t,e,n)=>{var r=n(8240),a=WeakMap.prototype;t.exports={WeakMap,set:r(a.set),get:r(a.get),has:r(a.has),remove:r(a.delete)}},211:(t,e,n)=>{var r=n(2086),a=n(9197),i=n(9606),o=n(5422),s=n(5558),c=n(1876),u=r.Symbol,l=a("wks"),p=c?u.for||u:u&&u.withoutSetter||o;t.exports=function(t){return i(l,t)||(l[t]=s&&i(u,t)?u[t]:p("Symbol."+t)),l[t]}},4182:(t,e,n)=>{"use strict";var r=n(1695),a=n(4226),i=n(4004).remove;r({target:"WeakMap",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var t,e=a(this),n=!0,r=0,o=arguments.length;r<o;r++)t=i(e,arguments[r]),n=n&&t;return!!n}})},5311:t=>{"use strict";t.exports=jQuery}},e={};function n(r){var a=e[r];if(void 0!==a)return a.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";n(4182);const t=window.top.document.querySelector("meta[name=atwiki-page-info]"),e=JSON.parse(t.dataset.pageInfoJson),r=e.wikiid||"",a=e.isSp,i=(e.isRwdSp,e.templateId),o=(e.displayads,e.articlePageid||0),s=(e.menubarPageid,e.menubar2Pageid,e.hedit,e.articleHedit,e.menubarHedit,e.menubar2Hedit,"atwiki-fast-load"),c=window.top.document.querySelector(`meta[name=${s}]`),u="1"===c?.content;var l=n(5311);function p(t,e,n){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,n)}function d(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,f(t,e,"set"),n),n}function m(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,f(t,e,"get"))}function f(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var h=new WeakMap,g=new WeakMap,v=new WeakMap,w=new WeakMap,b=new WeakMap,y=new WeakMap,x=new WeakMap,_=new WeakMap,k=new WeakMap,j=new WeakMap,S=new WeakMap,T=new WeakMap,O=new WeakMap,P=new WeakMap;class M{constructor(){p(this,h,{writable:!0,value:l("#atwiki-page-tags")}),p(this,g,{writable:!0,value:l(".atwiki-tags-wrap")}),p(this,v,{writable:!0,value:l("#tags-sortable")}),p(this,w,{writable:!0,value:l("#atwiki-page-tagedit")}),p(this,b,{writable:!0,value:l("#edit_form").length}),p(this,y,{writable:!0,value:m(this,b)?l("#tags_pedit"):l("#atwiki-tags-edit")}),p(this,x,{writable:!0,value:m(this,w).data("username")||""}),p(this,_,{writable:!0,value:l("#hidden_tags")}),p(this,k,{writable:!0,value:m(this,y).data("popular-tags")}),p(this,j,{writable:!0,value:1===(m(this,y).data("ajax-suggest")||0)}),p(this,S,{writable:!0,value:l("#tags_textarea")}),p(this,T,{writable:!0,value:[]}),p(this,O,{writable:!0,value:[]}),p(this,P,{writable:!0,value:!1})}registEvent(){if(m(this,P))return!1;m(this,v).sortable({cursor:"grabbing",opacity:.5,placeholder:"tags-sorting",distance:4,forcePlaceholderSize:!0,helper:"clone",tolerance:"pointer",start:function(t,e){const n=l(e.helper);n.innerWidth(n.innerWidth()+1)},update:()=>{this.saveTags(),this.adjustTagAreaHeight()}}),m(this,y).on("keydown",(t=>{if(188===t.keyCode||13===t.keyCode)return this.addTags(),!1}));const t=this;l(document).on("click",".tags_delete",(function(){l(this).parent().remove(),t.saveTags(),m(t,y).blur()})),m(this,y).autocomplete({minLength:0,delay:m(this,j)||!m(this,b)?500:0,source:async(t,e)=>{const n=m(this,_).val().split(","),r=""!==t.term;if(m(this,O).length&&!r&&m(this,T).toString()===n.toString())return void e(m(this,O));const a=m(this,j)&&r||!m(this,b)?await this.getTagSuggest(t.term):Object.keys(m(this,k)).filter((e=>0===e.indexOf(t.term))).reduce(((t,e)=>(t[e]=m(this,k)[e],t)),{});n.forEach((t=>{delete a[t]}));const i=Object.keys(a).map((t=>({tag:t,num:a[t]})));e(i),d(this,T,n),r||d(this,O,i)},select:(t,e)=>(m(this,y).val(e.item.tag),this.addTags(),!1)}).autocomplete("instance")._renderItem=function(t,e){const n=l('<div class="tags-suggest">').append(l(`<div class="tags-label">${e.tag}</div>`)).append(l(`<div class="tags-num">${e.num}ページ</div>`));return l("<li>").append(n).appendTo(t)},m(this,y).on("focus",(()=>{m(this,S).css("box-shadow","0 0 2px 2px #58ACFA"),""===m(this,y).val().trim()&&m(this,y).autocomplete("search","")})).on("blur",(()=>{this.addTags(),m(this,S).css("box-shadow","none")})),u&&l(document).off("submit",".page-tag-edit"),l(document).on("submit",".page-tag-edit",(async t=>{t.preventDefault();const e=l(t.currentTarget),n=l(".atwiki-tagedit-modal").find('button[type="submit"]'),r=n.text();n.text(n.data("disable-with")).prop("disabled",!0);try{const t=await this.getToken(m(this,x));await this.post(e,t),n.text(r).prop("disabled",!1)}catch(t){(new z).showPopUp(t)}})),d(this,P,!0)}addTags(){const t=m(this,y).val().split(","),e=this;t.forEach((function(t){const n=l.trim(t);if(""===n)return;const r=m(e,b)?"tags_frame":"atwiki-tag-frame tags_frame";m(e,v).append(`<li class="${r}" title="${n}">${n}<span class="tags_delete" role="button" tabindex="0"></span></li>`)})),this.saveTags(),this.adjustTagAreaHeight(),m(this,y).val("")}saveTags(){const t=l(".tags_frame").map(((t,e)=>l(e).text())).get().join(",");m(this,_).val(t)}async getTagSuggest(t){try{const e=await l.ajax({type:"get",url:`/${r}/tag_suggest`,data:{word:t},dataType:"json"});return"ok"!==e?.status?[]:e?.body}catch(t){return[]}}getToken(t){return new Promise(((e,n)=>{""!==t&&e("");const r=m(this,w).data("sitekey");grecaptcha.ready((()=>{grecaptcha.execute(r,{action:"page_tags_edit"}).then((t=>{e(t)}),(()=>{n("トークンの取得に失敗しました。")}))}))}))}async post(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=t.find(".page-tag-edit-hidden").val(),a=t.find(".page-original-tags").val(),i=m(this,w).data("pagename")||"";let o=[];try{o=await l.ajax({url:`/${r}/tag/`,type:"POST",data:{tags:n,original_tags:a,pagename:i,"g-recaptcha-response":e}})}catch(t){throw"タグの更新に失敗しました。"}if("ok"!==(o.status||"ng"))throw o.body||"";const s=n.split(",");if(n.length){let t="";l.each(s,(function(e,n){t+=`<a class="atwiki-tag-frame" href="/${r}/tag/${encodeURIComponent(n).replace("%2F","%252F")}"><i class="atwiki-tag-icon fa fa-tag"></i>${n}</a>`}));const e=`<p class="atwiki-tag-notation">タグ：</p>${t}`;m(this,g).html(e)}else m(this,g).find("a").remove();return l(".page-original-tags").val(s),m(this,h).css("margin-bottom",""),l(".atwiki-modal-bg").fadeOut(100),!0}adjustTagAreaHeight(){const t=m(this,h).outerHeight(),e=l(".atwiki-tagedit-modal").outerHeight()-t;m(this,h).css("margin-bottom",`${e}px`)}}var E=n(5311);function $(t,e,n){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,n)}function W(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,C(t,e,"get"))}function I(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,C(t,e,"set"),n),n}function C(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var A=new WeakMap,F=new WeakMap,U=new WeakMap,D=new WeakMap,L=new WeakMap,H=new WeakMap;class z{constructor(){$(this,A,{writable:!0,value:void 0}),$(this,F,{writable:!0,value:E("#atwiki-page-tags")}),$(this,U,{writable:!0,value:E(".atwiki-tagedit-modal")}),$(this,D,{writable:!0,value:E("#atwiki-modal-search-form")}),$(this,L,{writable:!0,value:E("#atwiki-modal-search-form .atwiki-search-input")}),$(this,H,{writable:!0,value:!1}),I(this,A,document.getElementById("atwiki-modal-file-display"))}openImage(t){const e=E(t),n=e.data("file-url"),r=e.data("file-name"),a=e.data("utime"),i=1===e.data("status")?`削除日時:${a} ${r}`:r;W(this,A).setAttribute("src",n),E(".atwiki-modal-title").text(i),E(".atwiki-modal-bg").fadeIn()}close(){E(".atwiki-modal-bg").fadeOut("fast",(()=>(null!==W(this,A)&&W(this,A).setAttribute("src","/common/_img/spacer.gif"),!1)))}run(){E(document).on("click",".atwiki-upload-thumbnail a",(t=>{this.openImage(t.currentTarget)}));const t=new M;if(E(".tags-edit-button").on("click",(async()=>{await this.getJqueryUiFile(),t.registEvent(),W(this,U).show(),t.adjustTagAreaHeight()})),a||i>300){const t="atwiki-fixed-search-modal";E(".atwiki-search:not(.atwiki-modal-search)").on("click",(async e=>{await this.getJqueryUiFile(),E(e.currentTarget).hasClass("atwiki-fixed-search")?W(this,D).addClass(t):W(this,D).removeClass(t),this.registSuggestEvent(),W(this,D).show(),W(this,L).focus()}))}E(document).on("click",".atwiki-word-search",(function(){E("#atwiki-modal-search-form .atwiki-search").submit()})),E(document).on("click",".atwiki-modal",(t=>{t.stopPropagation()})),E(document).on("click",".atwiki-modal-bg, .atwiki-modal-close",(()=>{this.close(),W(this,F).css("margin-bottom","")}))}registSuggestEvent(){if(W(this,H))return!1;const t=E(".atwiki-search-description"),e="#atwiki-modal-search-form .atwiki-modal-body",n="atwiki-word-search",a="フォームにキーワードを入力することで該当するページ名が表示されます。";t.text(a),W(this,L).autocomplete({minLength:0,delay:100,appendTo:e,source:async(e,r)=>{if(""===e.term)return E(`.ui-autocomplete li, .${n}`).remove(),t.text(a),!1;const i=await this.getPageNameSuggest(e.term);delete i[o],r(Object.keys(i).map((t=>({pageid:t,pagename:i[t]}))))},select:()=>(W(this,D).find('input[type="search"]').val(""),E(`.ui-autocomplete li, .${n}`).remove(),W(this,D).hide(),!1),response:(r,a)=>{E(`.${n}`).length||E(e).prepend(E(`<div class="${n}">全文検索</div>`)),a.content.length||(E(".ui-autocomplete li").remove(),t.text("キーワードに該当するページ名がありません。「全文検索」をクリックすることでページ内の文章から検索することができます。"))},open:()=>{t.text(""),E(".ui-autocomplete").css({left:0,top:"36px"})}}).blur((function(){E("#atwiki-modal-search-form .ui-autocomplete").show()})).autocomplete("instance")._renderItem=function(t,e){const n=E(`<a class="atwiki-search-modal-link" href="/${r}/pages/${e.pageid}.html">${e.pagename}</a>`);return E("<li>").append(n).appendTo(t)},I(this,H,!0)}async getPageNameSuggest(t){try{const e=await E.ajax({type:"get",url:`/${r}/pagename_suggest`,data:{word:t},dataType:"json"});return"ok"!==e?.status?[]:e?.body}catch(t){return[]}}async getJqueryUiFile(){if(E('link[href*="/base/autocomplete.min.css"]').length)return!0;E("<link/>",{rel:"stylesheet",href:"https://cdn.jsdelivr.net/npm/jquery-ui@1.13.2/themes/base/autocomplete.min.css"}).appendTo("head"),E("<link/>",{rel:"stylesheet",href:"https://cdn.jsdelivr.net/npm/jquery-ui@1.13.2/themes/base/all.min.css"}).appendTo("head"),await E.getScript("https://cdn.jsdelivr.net/npm/jquery-ui@1.13.2/dist/jquery-ui.min.js")}showPopUp(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=E(".atwiki-popup-bg");""!==t&&n.find(".popup_body").text(t),e?n.find(".popup_reload_btn").show():n.find(".popup_reload_btn").hide(),n.show()}}n(5311)((function(t){const e=t(".atwiki_page_comment_area"),n=window.frameElement;if(e.length<=0)return!1;const r=e.find(".atwiki_page_comment"),a=r.find(".comment_reply_form"),i=r.find(".comment_edit_form"),o=r.find(".comment_delete_form"),s=r.data("username")||"",c=r.data("pageid")||0,u=r.data("wikiid")||"",l=r.data("is_admin")||0,p=parseInt(t(".comment-height-limit").css("max-height")),d=t("<div>"),m=r.data("viewmode")||"tree",f="[編集済み]",h="名無しさん";let g=!1;const v=new z,w=()=>{n&&(n.height=e.outerHeight())},b=(e,n,a,i,o,p,d,g)=>{e=parseInt(e),n=parseInt(n),a=parseInt(a);const v=t("#comment_0").clone(!0);v.show(),v.attr("id",`comment_${e}`),v.data("id",e),v.data("rid",n),v.data("pid",a),v.find(".comment_id").text(e),v.find(".comment_username").text(p||h),v.find(".comment_update_time").text(g),v.find(".comment_context").html(o),v.find(".comment-ip").text(d),"deleted"===i?v.find(".comment_status").text(""):"edited"===i&&v.find(".comment_status").attr({title:g}).text(f),a>0?v.find(".comment_res_anchor").append(`<a href="/${u}/page_comment/${c}/${a}" target="_top">&gt;&gt;${a}</a>`):v.find(".comment_res_anchor").hide(),"deleted"!==i&&(v.find(".comment_reply_button").show(),""!==p&&s===p?(v.find(".comment_edit_button").show(),v.find(".comment_delete_button").show()):l&&v.find(".comment_delete_button").show());let w="> ul";a>0&&"tree"===m&&(w=`#comment_${a} > ul.comment_children`,r.find(w).length<=0&&r.find(`#comment_${a}`).append(t("<ul>",{class:"comment_children"}))),r.find(w).append(v)},y=()=>{t(".comment-height-limit").each((function(){t(this).find(".comment_context").height()>p?t(this).siblings(".comment-more-button").show():j(t(this).siblings(".comment-more-button"))}))},x=(e,n,r,a)=>{const i=t(`#comment_${e}`);let o=f;"deleted"===n&&(o="",i.find(".comment-button-row").hide(),i.find(".comment_username:first").text(h),i.find(".comment_update_time:first").text(""),i.find(".comment-ip:first").text("")),i.find(".comment_status:first").attr({title:a}).text(o),i.find(".comment_context:first").html(r)},_=function(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((n=>{if(n.id===e)return;const r=t(`#comment_${n.id}`);r.length<=0?b(n.id,n.rid,n.pid,n.status,n.context,n.username,n.ip,n.utime):n.utime!==r.find(".comment_update_time:first").text()&&x(n.id,n.status,n.context,n.utime)}))},k=()=>{a.hide(),i.hide(),o.hide(),r.find(".provisional").remove(),r.find(".comment_status").show(),r.find(".comment-buttons > button").removeClass("active"),r.find(".comment_textarea_context").val(""),r.find(".comment_context").show()};t(document).on("submit",".comment_added_form, .atwiki_comment_form",(async e=>{e.preventDefault();const n=t(e.currentTarget),a=n.find('button[type="submit"]'),i=a.text();a.text(a.data("disable-with")).prop("disabled",!0);const o=await(t=>new Promise(((e,n)=>{""!==t&&e("");const a=r.data("sitekey");grecaptcha.ready((()=>{grecaptcha.execute(a,{action:"page_comment"}).then((t=>{e(t)}),(()=>{n("トークンの取得に失敗しました。")}))}))})))(s).catch((t=>{v.showPopUp(t)}));await function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Promise(((r,a)=>{const i=e.data("mode"),o=e.find(".comment_textarea_context").val();let l=0,p=0,d=0;if("new"!==i){const t=e.closest("li.atwiki_comment");l=t.data("id"),p=t.data("rid")||l,d=l}t.ajax({url:`/${u}/page_comment/`,type:"POST",data:{mode:i,id:l,rid:p,pid:d,context:o,pageid:c,"g-recaptcha-response":n}}).done((t=>{"ok"!==(t.status||"ng")&&a(t.body||""),_(t.commentList,t.result.id),"new"===i||"reply"===i?b(t.result.id||0,p,d,t.result.status||"",t.result.context||"",s,t.result.ip||"",t.result.utime||""):x(l,t.result.status||"",t.result.context||"",t.result.utime||""),y(),r()})).fail(((t,e,n)=>{a("Forbidden"===n?"投稿内容に禁止ワードを含んでいる可能性があります。管理者に直接禁止ワードの修正を依頼するか、管理者もしくはメンバーの場合、ログインしてください。":"コメントの投稿に失敗しました。")}))}))}(n,o).catch((t=>{v.showPopUp(t)})),a.text(i).prop("disabled",!1),k(),w()})),t(document).on("click",".comment_reply_button, .comment_edit_button, .comment_delete_button",(e=>{const n=t(e.currentTarget);if(n.hasClass("active"))return k(),void w();const r=n.closest(".atwiki_comment");k(),n.addClass("active");let s=r.data("id"),c=n.data("mode");if("reply"===c)a.find(".comment_reply_id").text(s),r.find("> ul").length<=0&&r.append(t("<ul>",{class:"provisional"})),r.find("> ul").append(t("<li>",{class:"provisional"})),a.show().appendTo(r.find("> ul > li:last-of-type")),a.find(".comment_textarea_context").val("").focus();else if("edit"===c){r.find(".comment_status:first").hide();const t=r.find(".comment_context:first").hide();i.show().insertAfter(t),i.find(".comment_textarea_context").val((u=t.html(),d.html(u).text().replace(/&ltbr&gt/g,""))).focus(),j(r.find(".comment-more-button"))}else"delete"===c?r.find("> div").append(o.show()):v.showPopUp("不正な操作です。");var u;w()}));const j=t=>{t.siblings(".comment-height-limit").removeClass("comment-height-limit"),t.hide(),w()};if(t(".delete_cancel_button").on("click",(()=>{k()})),t(document).on("click",".comment-more-button",(function(){j(t(this)),w()})),c<=0||""===u)return v.showPopUp("コメントできないページです。",!1),!1;if(!n)return v.showPopUp("ページの表示方法に誤りがあります。",!1),!1;const S=t(top.window!==window?top.window:window);S.on("load scroll resize orientationchange",(e=>{S.scrollTop()+S.height()+200>(n?t(n).offset().top:0)&&(g||(g=!0,t.ajax({url:`/${u}/page_comment/get/`,type:"GET",data:{pageid:c,viewmode:m}}).done(((t,e,n)=>{if("ok"!==(t.status||"ng")||!Array.isArray(t.result))return v.showPopUp(t.body||""),!1;_(t.result),y(),w()})).fail((t=>{v.showPopUp(t.body||"")}))),t(document).off(e))})),S.on("resize orientationchange",(()=>{y(),w()})),w()}))})()})();